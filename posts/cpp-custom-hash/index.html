<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Custom Hash Functions for C++ Unordered Containers" /><meta name="author" content="Ian Y.E. Pan" /><meta property="og:locale" content="en_US" /><meta name="description" content="For simplicity, I’ll be “using namespace std” throughout this post. In production code, one should refrain from such pollution of namespace, though." /><meta property="og:description" content="For simplicity, I’ll be “using namespace std” throughout this post. In production code, one should refrain from such pollution of namespace, though." /><link rel="canonical" href="https://ianyepan.github.io/posts/cpp-custom-hash/" /><meta property="og:url" content="https://ianyepan.github.io/posts/cpp-custom-hash/" /><meta property="og:site_name" content="Ian Y.E. Pan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-03T02:44:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Custom Hash Functions for C++ Unordered Containers" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@Ian Y.E. Pan" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ian Y.E. Pan"},"dateModified":"2022-02-05T07:21:31+08:00","datePublished":"2022-02-03T02:44:00+08:00","description":"For simplicity, I’ll be “using namespace std” throughout this post. In production code, one should refrain from such pollution of namespace, though.","headline":"Custom Hash Functions for C++ Unordered Containers","mainEntityOfPage":{"@type":"WebPage","@id":"https://ianyepan.github.io/posts/cpp-custom-hash/"},"url":"https://ianyepan.github.io/posts/cpp-custom-hash/"}</script><title>Custom Hash Functions for C++ Unordered Containers | Ian Y.E. Pan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ian Y.E. Pan"><meta name="application-name" content="Ian Y.E. Pan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/36686900?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ian Y.E. Pan</a></div><div class="site-subtitle font-italic">software engineer, emacs enthusiast, keyboard lover. occasionally nerdy.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ianyepan" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/ianyepan/" aria-label="linkedin" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ian.pan','columbia.edu'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always use light mode by default: Experimental */ /* self.setLight(); */ /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Custom Hash Functions for C++ Unordered Containers</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Custom Hash Functions for C++ Unordered Containers</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Ian Y.E. Pan </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Feb 3, 2022, 2:44 AM +0800" prep="on" > Feb 3, 2022 <i class="unloaded">2022-02-03T02:44:00+08:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Feb 4, 2022, 6:21 PM -0500" prefix="Updated " > Feb 4, 2022 <i class="unloaded">2022-02-05T07:21:31+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1040 words">5 min</span></div></div><div class="post-content"><blockquote><p>For simplicity, I’ll be “using namespace std” throughout this post. In production code, one should refrain from such pollution of namespace, though.</p></blockquote><h2 id="motivation-and-background">Motivation and Background</h2><p>C++ unordered containers (e.g. <code class="language-plaintext highlighter-rouge">unordered_map</code>, <code class="language-plaintext highlighter-rouge">unordered_set</code>, etc.) uses “hashing” to store objects. The STL provides hash functions for commonly used types, like <code class="language-plaintext highlighter-rouge">string</code> and numeric values such as <code class="language-plaintext highlighter-rouge">int</code>, meaning that we won’t have to provide any hash functions explicitly when creating an unordered container instance:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">names</span><span class="p">{</span><span class="s">"Ian"</span><span class="p">,</span> <span class="s">"Y.E."</span><span class="p">,</span> <span class="s">"Pan"</span><span class="p">};</span> <span class="c1">// good</span>
</pre></table></code></div></div><p>However, when we want to hold a more complex type, or even a user-defined class, C++ unordered containers would fail to find a hash function for itself to use. This is when custom hash functions come in. We will have to explicitly define a hash function for the type (e.g. <code class="language-plaintext highlighter-rouge">pair&lt;string, int&gt;</code>) that we want to use as a template argument for some unordered container.</p><h2 id="implementation-idea-exclusive-or">Implementation Idea: Exclusive-Or</h2><p>According to the book “A Tour of C++” by Bjarne Stroustrup, “A hash function is often provided as a function object”. And creating a new hash function by “combining existing functions using exclusive-or (<code class="language-plaintext highlighter-rouge">^</code>) is simple and often very effective”.</p><p>Intuitively, this means that if we want to hash a pair of string and integer, we could use the following “new” hash function:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1">// p is a pair&lt;string, int&gt;</span>
<span class="n">hash</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">{}(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">^</span> <span class="n">hash</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{}(</span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">);</span> <span class="c1">// simple and effective</span>
</pre></table></code></div></div><p>The next thing we need to do is to pass that as a template argument when creating our unordered container. For an <code class="language-plaintext highlighter-rouge">unordered_set</code>, that will be the second argument. For an <code class="language-plaintext highlighter-rouge">unordered_map</code>, that’ll be the third argument after the key type and the value type. Note that we only need the hashing function for a map’s “key”, not the value.</p><h2 id="method-1-function-object-with-struct">Method 1: Function Object with Struct</h2><p>Perhaps the most commonly used method (and also my preferred method) is to create a function object (functor) using a struct, and implement its <code class="language-plaintext highlighter-rouge">operator()</code> function. This function is to be qualified as <code class="language-plaintext highlighter-rouge">const</code>, and takes a const reference to the custom type and returns a <code class="language-plaintext highlighter-rouge">size_t</code>. Defining a function object outside as a standalone struct also gives it the flexibility of “generic programming” with templates. Meaning that it can work with pairs of different template arguments, not just strings and ints.</p><p>Putting this all together, we have:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">PairHash</span> <span class="p">{</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
  <span class="k">auto</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">pair</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="k">const</span> <span class="o">-&gt;</span> <span class="kt">size_t</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">hash</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">&gt;</span><span class="p">{}(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">^</span> <span class="n">hash</span><span class="o">&lt;</span><span class="n">T2</span><span class="o">&gt;</span><span class="p">{}(</span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Example</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="kt">void</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">PairHash</span><span class="o">&gt;</span> <span class="n">uset</span><span class="p">;</span>
    <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">int</span> <span class="p">,</span> <span class="n">PairHash</span><span class="o">&gt;</span> <span class="n">umap</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></table></code></div></div><h2 id="method-2-custom-lambda-hash-function">Method 2: Custom Lambda Hash Function</h2><p>Alternatively, we can also implement our custom hash function as a lambda. Some may find this inline implementation more elegant. A drawback is that C++11 lambdas do not support templates. Fortunately, we have “generic lambdas” since C++14 (as seen below).</p><p>Another drawback is that we need to use <code class="language-plaintext highlighter-rouge">decltype</code> of the lambda as the extra custom hash function argument for our unordered containers, and also provide constructor arguments in parentheses after the declared variable name. Both <code class="language-plaintext highlighter-rouge">unordered_set</code> and <code class="language-plaintext highlighter-rouge">unordered_map</code> have a constructor that takes an initial number of buckets and a hashing object as inputs. Here, I just arbitrarily let the initial buckets be 10.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Example</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="kt">void</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">pairHash</span> <span class="o">=</span> <span class="p">[]</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T2</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">pair</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">hash</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">&gt;</span><span class="p">{}(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">^</span> <span class="n">hash</span><span class="o">&lt;</span><span class="n">T2</span><span class="o">&gt;</span><span class="p">{}(</span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">pairHash</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">seen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">pairHash</span><span class="p">);</span>
    <span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">int</span> <span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">pairHash</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">umap</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">pairHash</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></table></code></div></div><h2 id="method-3-defining-a-specialization-of-stdhash">Method 3: Defining a Specialization of std::hash()</h2><p>In this method, we add a specialization of standard-library’s hash function to the namespace <code class="language-plaintext highlighter-rouge">std</code>. This is quite similar to the first method, except now we must use <code class="language-plaintext highlighter-rouge">hash</code> as the name of our function object. We also have to specify the template class for which we are defining the specialization. The immediate advantage is that we do not need to pass in any extra template arguments to our unordered container when declaring an instance.</p><p>Here is an example of this method, suppose we want to be able to hash a user-defined class <code class="language-plaintext highlighter-rouge">XYZ</code>, which has a member called <code class="language-plaintext highlighter-rouge">value</code>:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">hash</span><span class="o">&lt;</span><span class="n">XYZ</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">XYZ</span> <span class="o">&amp;</span><span class="n">xyz</span><span class="p">)</span> <span class="k">const</span> <span class="o">-&gt;</span> <span class="kt">size_t</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">hash</span><span class="o">&lt;</span><span class="n">XYZ</span><span class="o">&gt;</span><span class="p">{}(</span><span class="n">xyz</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="p">}</span>  <span class="c1">// namespace std</span>

<span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">XYZ</span><span class="o">&gt;</span> <span class="n">xset</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="overloading-operator">Overloading operator==()</h2><p>Note that the unordered containers also need the ability to compare two different keys using <code class="language-plaintext highlighter-rouge">==</code>. In previous examples, I have been using <code class="language-plaintext highlighter-rouge">std::pair</code>, and the STL already defines <code class="language-plaintext highlighter-rouge">operator==()</code> for pairs, so I didn’t have to define my own equality logic. However, if we are using our own user-defined class, then we need to define the equality operator. For example, here’s how we can define <code class="language-plaintext highlighter-rouge">operator==()</code> for our custom class <code class="language-plaintext highlighter-rouge">Record</code>:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Record</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="c1">// ...</span>
  <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Record</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">id</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">id</span><span class="p">;</span> <span class="c1">// no problem accessing other.id</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">getId</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Note that <code class="language-plaintext highlighter-rouge">operator==</code> can access private members “id” of “another” Record object, because it is a “member function”. Member functions can access private members of its class, not only for <code class="language-plaintext highlighter-rouge">this</code>, but also for any instance of the same class. To read more on this topic, consider <a href="https://stackoverflow.com/questions/12479875/why-overloading-can-access-private-members-of-argument">this StackOverflow thread</a>.</p><p>With <code class="language-plaintext highlighter-rouge">Record</code>’s equality operator defined, we can proceed to define our custom hash function for <code class="language-plaintext highlighter-rouge">Record</code>. Let’s use the third method for this example.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">hash</span><span class="o">&lt;</span><span class="n">Record</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Record</span> <span class="o">&amp;</span><span class="n">record</span><span class="p">)</span> <span class="k">const</span> <span class="o">-&gt;</span> <span class="kt">size_t</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">hash</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">()(</span><span class="n">record</span><span class="p">.</span><span class="n">getId</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="p">}</span>  <span class="c1">// namespace std</span>
</pre></table></code></div></div><p>Now, we can finally use <code class="language-plaintext highlighter-rouge">Record</code> as the key to our unordered container, simply as follows:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">Record</span><span class="o">&gt;</span> <span class="n">recordsSet</span><span class="p">;</span>
<span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">Record</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">recordsMap</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="conclusions-and-further-readings">Conclusions and Further Readings</h2><p>In this short blog post, I introduced various ways to create custom functions for unordered containers that hold relatively complex STL types or user-defined class objects. If you’d like to read more on this topic, I recommend <a href="https://marknelson.us/posts/2011/09/03/hash-functions-for-c-unordered-containers.html">this blog post</a> by Mark Nelson and also <a href="https://en.cppreference.com/w/cpp/utility/hash">this page</a> at Cppreference.com.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/programming/'>Programming</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/programming/" class="post-tag no-text-decoration" >programming</a> <a href="/tags/tips/" class="post-tag no-text-decoration" >tips</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Custom Hash Functions for C++ Unordered Containers - Ian Y.E. Pan&url=https://ianyepan.github.io/posts/cpp-custom-hash/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Custom Hash Functions for C++ Unordered Containers - Ian Y.E. Pan&u=https://ianyepan.github.io/posts/cpp-custom-hash/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Custom Hash Functions for C++ Unordered Containers - Ian Y.E. Pan&url=https://ianyepan.github.io/posts/cpp-custom-hash/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/system-default-monospace-fonts-pt1/">Gentle Intro to System Default Monospace Fonts (Part 1/2)</a><li><a href="/posts/cpp-notes-pt2/">A Tour of C++ - Reading Notes (Part 2/2)</a><li><a href="/posts/cpp-notes-pt1/">A Tour of C++ - Reading Notes (Part 1/2)</a><li><a href="/posts/c-web-server/">Building a Simple Web Server in C - an open source project</a><li><a href="/posts/sticky-notes/">Syncing Sticky Notes Between Laptop and Mobile</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/tips/">tips</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/emacs/">emacs</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/workflow/">workflow</a> <a class="post-tag" href="/tags/chinese/">chinese</a> <a class="post-tag" href="/tags/fonts/">fonts</a> <a class="post-tag" href="/tags/essay/">essay</a> <a class="post-tag" href="/tags/fragrance/">fragrance</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/emacs-ide/"><div class="card-body"> <span class="timeago small" > Feb 11, 2022 <i class="unloaded">2022-02-11T09:18:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building an Intelligent Emacs</h3><div class="text-muted small"><p> This post introduces the combination of Emacs and LSP, and how you can make your own editor “smarter” by using the same idea of communications between an editor client and multiple language serv...</p></div></div></a></div><div class="card"> <a href="/posts/emacs-emojis/"><div class="card-body"> <span class="timeago small" > Feb 17, 2022 <i class="unloaded">2022-02-17T11:18:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Native Emojis in Emacs</h3><div class="text-muted small"><p> This short post will help you set up emoji support in Emacs. First, let’s see the results: Emacs showing emojis Step one, you must have an emoji font installed. I really adore the new fluent de...</p></div></div></a></div><div class="card"> <a href="/posts/emacs-git-gutter/"><div class="card-body"> <span class="timeago small" > Feb 18, 2022 <i class="unloaded">2022-02-18T03:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Git Gutter in Emacs</h3><div class="text-muted small"><p> When I first started programming using Visual Studio Code, I’ve benefited much from the git gutter indicators that show added/deleted/modified code blocks that haven’t been committed by git. This a...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cpp-notes-pt1/" class="btn btn-outline-primary" prompt="Older"><p>A Tour of C++ - Reading Notes (Part 1/2)</p></a> <a href="/posts/cpp-notes-pt2/" class="btn btn-outline-primary" prompt="Newer"><p>A Tour of C++ - Reading Notes (Part 2/2)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/ianyepan">Ian Y.E. Pan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Source code to this website can be found <a href="https://github.com/ianyepan/ianyepan.github.io">here.</a></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/tips/">tips</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/emacs/">emacs</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/workflow/">workflow</a> <a class="post-tag" href="/tags/chinese/">chinese</a> <a class="post-tag" href="/tags/fonts/">fonts</a> <a class="post-tag" href="/tags/essay/">essay</a> <a class="post-tag" href="/tags/fragrance/">fragrance</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ianyepan.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
